<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TH8.AI Full Lifecycle Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Prompt', sans-serif; }
        .font-code { font-family: 'JetBrains Mono', monospace; }
        
        .step-container {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .step-container.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* PDF Mockup Highlight */
        .pdf-highlight {
            background-color: rgba(253, 224, 71, 0.4);
            border-bottom: 2px solid #ca8a04;
            transition: background-color 0.3s;
        }
        .pdf-highlight.active-focus {
            background-color: rgba(253, 224, 71, 0.9);
            box-shadow: 0 0 10px rgba(253, 224, 71, 0.5);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">

    <!-- HEADER & PROGRESS -->
    <header class="bg-slate-900 text-white sticky top-0 z-50 shadow-md">
        <div class="max-w-5xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-sky-600 rounded-lg flex items-center justify-center font-bold text-lg">TH8</div>
                    <div>
                        <h1 class="font-bold text-sm uppercase tracking-wider">End-to-End Procurement Flow</h1>
                        <p class="text-[10px] text-slate-400">Enterprise Demo Scenario: High Value + SLA Risk</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="resetDemo()" class="text-xs text-slate-400 hover:text-white underline">Reset Demo</button>
                </div>
            </div>

            <!-- Stepper -->
            <div class="flex justify-between items-center relative">
                <div class="absolute top-1/2 left-0 w-full h-0.5 bg-slate-700 -z-10"></div>
                <!-- Steps generated by JS for cleaner code -->
                <div id="stepper-container" class="w-full flex justify-between">
                    <!-- Injected via JS -->
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-5xl w-full mx-auto px-6 py-8">

        <!-- STEP 0: POLICY SELECTION -->
        <div id="step-0" class="step-container active">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-slate-100 px-6 py-4 border-b border-slate-200 flex justify-between items-center">
                    <h2 class="font-bold text-slate-800 flex items-center gap-2">
                        <span class="w-6 h-6 bg-slate-800 text-white rounded-full flex items-center justify-center text-xs">0</span>
                        Policy Configuration
                    </h2>
                    <span class="text-xs text-slate-500"><i data-lucide="lock" class="w-3 h-3 inline mr-1"></i>Immutable Binding</span>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">Select Active Policy Version</label>
                        <select id="policy-select" class="w-full md:w-1/2 p-2 border border-slate-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-sky-500 outline-none">
                            <option value="v3.2">Procurement_Policy_v3.2 (Current - Approved by Board)</option>
                            <option value="v3.1">Procurement_Policy_v3.1 (Archived)</option>
                        </select>
                    </div>
                    
                    <div class="bg-slate-900 rounded-lg p-4 font-code text-xs text-slate-300 relative group">
                        <div class="absolute top-2 right-2 text-[10px] text-slate-500">policy_v3.2.yaml</div>
                        <pre>
rules:
  - id: "HIGH_AMOUNT_ESCALATION"
    condition: "amount > 3000000"
    action: "ESCALATE_TO_MANAGER"
    severity: "HIGH"

  - id: "SLA_RISK_WARNING"
    condition: "sla_remaining_hours <= 6"
    action: "WARN_OFFICER"
    severity: "MEDIUM"</pre>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button onclick="nextStep(1)" class="bg-sky-600 hover:bg-sky-700 text-white px-6 py-2 rounded-lg text-sm font-bold shadow transition flex items-center gap-2">
                            Load & Bind Policy <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 1: INGESTION -->
        <div id="step-1" class="step-container">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-slate-100 px-6 py-4 border-b border-slate-200">
                    <h2 class="font-bold text-slate-800 flex items-center gap-2">
                        <span class="w-6 h-6 bg-slate-800 text-white rounded-full flex items-center justify-center text-xs">1</span>
                        Ingest Event (Simulation)
                    </h2>
                </div>
                <div class="p-6">
                    <p class="text-sm text-slate-500 mb-6">Simulate a high-risk PR coming from ERP (SAP/Oracle).</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">PR ID</label>
                            <input type="text" value="PR-2024-9981" class="w-full p-2 border border-slate-200 rounded bg-slate-50 text-sm" readonly>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Vendor Name</label>
                            <input type="text" value="TechSpace Solutions Co., Ltd." class="w-full p-2 border border-slate-200 rounded bg-slate-50 text-sm" readonly>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Total Amount (THB)</label>
                            <div class="relative">
                                <input type="text" value="3,500,000" class="w-full p-2 border border-red-300 bg-red-50 text-red-700 font-bold rounded text-sm" readonly>
                                <span class="absolute right-2 top-2 text-[10px] text-red-500 font-bold">Over Threshold (>3M)</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">SLA Deadline</label>
                            <div class="relative">
                                <input type="text" value="Today, 17:00 (4 hrs left)" class="w-full p-2 border border-amber-300 bg-amber-50 text-amber-700 font-bold rounded text-sm" readonly>
                                <span class="absolute right-2 top-2 text-[10px] text-amber-600 font-bold">Urgent (< 6h)</span>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 flex justify-end">
                        <button onclick="nextStep(2)" class="bg-slate-900 hover:bg-slate-800 text-white px-6 py-2 rounded-lg text-sm font-bold shadow transition flex items-center gap-2">
                            Simulate Ingest <i data-lucide="upload-cloud" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 2 & 3 combined for flow: DETAIL & RUN DECISION -->
        <div id="step-2" class="step-container">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Case Detail Card -->
                <div class="md:col-span-1 space-y-4">
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Case Status</h3>
                        <div class="space-y-3">
                            <div>
                                <span class="block text-[10px] text-slate-500">External Status (ERP)</span>
                                <span class="inline-block px-2 py-1 bg-slate-100 text-slate-600 text-xs font-bold rounded">Submitted</span>
                            </div>
                            <div class="relative overflow-hidden">
                                <span class="block text-[10px] text-slate-500">TH8 Decision Status</span>
                                <span class="inline-block px-2 py-1 bg-sky-100 text-sky-700 text-xs font-bold rounded animate-pulse">Pending Decision...</span>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="runDecisionEngine()" id="btn-run-decision" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl text-sm font-bold shadow-lg shadow-indigo-200 transition flex items-center justify-center gap-2">
                        <i data-lucide="zap" class="w-4 h-4"></i> Run AI Decision Engine
                    </button>
                </div>

                <!-- Result Area (Initially Hidden) -->
                <div id="decision-result" class="md:col-span-2 bg-white rounded-xl border border-slate-200 shadow-sm p-6 opacity-50 pointer-events-none filter blur-sm transition-all duration-500">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <i data-lucide="list-checks" class="w-5 h-5 text-indigo-600"></i> Rule Execution Result
                    </h3>
                    
                    <div class="space-y-3 mb-6">
                        <!-- Rule 1 -->
                        <div class="flex items-center justify-between p-3 bg-red-50 border border-red-100 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500"></i>
                                <div>
                                    <div class="text-xs font-bold text-red-700">HIGH_AMOUNT_ESCALATION</div>
                                    <div class="text-[10px] text-red-600">Condition: 3.5M > 3.0M</div>
                                </div>
                            </div>
                            <span class="text-[10px] font-bold bg-red-200 text-red-800 px-2 py-1 rounded">MATCH</span>
                        </div>
                        <!-- Rule 2 -->
                        <div class="flex items-center justify-between p-3 bg-amber-50 border border-amber-100 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i data-lucide="clock" class="w-5 h-5 text-amber-500"></i>
                                <div>
                                    <div class="text-xs font-bold text-amber-700">SLA_RISK_WARNING</div>
                                    <div class="text-[10px] text-amber-600">Condition: 4h <= 6h</div>
                                </div>
                            </div>
                            <span class="text-[10px] font-bold bg-amber-200 text-amber-800 px-2 py-1 rounded">MATCH</span>
                        </div>
                    </div>

                    <div class="border-t border-slate-100 pt-4 flex justify-between items-center">
                        <div>
                            <span class="block text-[10px] text-slate-500 uppercase font-bold">Required Role</span>
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 rounded-full bg-slate-800 text-white flex items-center justify-center text-[10px]">M</div>
                                <span class="text-sm font-bold text-slate-800">Procurement Manager</span>
                            </div>
                        </div>
                        <button onclick="nextStep(4)" class="text-sm text-sky-600 font-bold hover:underline flex items-center gap-1">
                            Proceed to Evidence <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 4: EVIDENCE (RAG) -->
        <div id="step-4" class="step-container">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden h-[500px] flex">
                <!-- Left: AI Insight -->
                <div class="w-1/3 border-r border-slate-200 p-6 flex flex-col">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                        <i data-lucide="sparkles" class="w-4 h-4 text-purple-600"></i> AI Insight (RAG)
                    </h3>
                    <div class="bg-purple-50 border border-purple-100 p-4 rounded-lg mb-4">
                        <p class="text-sm text-purple-900 leading-relaxed">
                            "ราคาที่เสนอ (3.5M) สูงกว่าราคามาตรฐาน แต่ได้รับอนุญาตตามสัญญาเนื่องจากเป็น Lot เร่งด่วน (Urgent Request)"
                        </p>
                    </div>
                    
                    <div class="mt-auto">
                        <p class="text-[10px] text-slate-400 uppercase font-bold mb-2">Supporting Documents</p>
                        <button onclick="highlightEvidence()" class="w-full text-left p-3 rounded border border-slate-200 hover:border-sky-500 hover:bg-sky-50 transition group">
                            <div class="flex items-center gap-2">
                                <i data-lucide="file-text" class="w-4 h-4 text-slate-500 group-hover:text-sky-600"></i>
                                <div>
                                    <div class="text-xs font-bold text-slate-700 group-hover:text-sky-700">Master_Contract_2024.pdf</div>
                                    <div class="text-[10px] text-sky-600 font-bold">Click to view Clause 4.2</div>
                                </div>
                            </div>
                        </button>
                    </div>
                    
                    <button onclick="nextStep(5)" class="mt-4 bg-slate-900 text-white py-2 rounded-lg text-sm font-bold shadow hover:bg-slate-800">
                        Make Decision
                    </button>
                </div>

                <!-- Right: PDF Mockup -->
                <div class="w-2/3 bg-slate-100 p-8 overflow-y-auto relative">
                    <div class="bg-white shadow-lg min-h-[600px] p-8 max-w-2xl mx-auto text-slate-800 font-serif text-sm leading-7">
                        <h1 class="text-center font-bold text-xl mb-8">MASTER SUPPLY AGREEMENT</h1>
                        <p class="mb-4 text-justify">1.1 General Terms: This agreement is made between The Company and Vendor...</p>
                        <p class="mb-4 text-justify">...</p>
                        <p class="mb-4 text-justify font-bold">4. PRICING & ADJUSTMENTS</p>
                        <p class="mb-4 text-justify">4.1 Standard Pricing: All items shall follow the price list attached in Annex A.</p>
                        <p id="evidence-clause" class="mb-4 text-justify pdf-highlight p-1">
                            <strong>4.2 Urgent Requests:</strong> In cases where the delivery lead time is requested to be less than 24 hours (Urgent), the Vendor is entitled to a <span class="font-bold">surcharge not exceeding 10%</span> of the total order value, provided that stock availability is confirmed.
                        </p>
                        <p class="mb-4 text-justify">4.3 Currency: All payments shall be made in THB...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 5: APPROVE / REJECT -->
        <div id="step-5" class="step-container">
            <div class="max-w-xl mx-auto bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                <div class="bg-slate-900 px-6 py-4 text-white">
                    <h2 class="font-bold flex items-center gap-2">
                        <i data-lucide="gavel" class="w-5 h-5"></i> Final Decision
                    </h2>
                </div>
                <div class="p-6">
                    <div class="mb-6">
                        <label class="block text-sm font-bold text-slate-700 mb-2">
                            Reason for Decision <span class="text-red-500">*</span>
                        </label>
                        <textarea id="decision-reason" rows="3" class="w-full p-3 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-sky-500 outline-none" placeholder="e.g., Approved as per Contract Clause 4.2 (Urgent Surcharge)"></textarea>
                        <p class="text-[10px] text-slate-400 mt-1">This reason will be immutable in the Audit Log.</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="finalizeDecision('REJECTED')" class="py-3 border border-red-200 text-red-600 rounded-lg font-bold hover:bg-red-50 transition">
                            Reject
                        </button>
                        <button onclick="finalizeDecision('APPROVED')" class="py-3 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 shadow transition">
                            Approve
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 6: AUDIT TIMELINE -->
        <div id="step-6" class="step-container">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-8">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xl font-bold text-slate-900">Audit Trail: Case #PR-2024-9981</h2>
                    <span class="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-500">API: /audit/case/9981</span>
                </div>

                <div class="relative pl-8 border-l-2 border-slate-200 space-y-8" id="audit-timeline">
                    <!-- Events will be injected here -->
                </div>

                <div class="mt-8 text-center">
                    <button onclick="resetDemo()" class="text-sm text-sky-600 font-bold hover:underline">Start New Demo</button>
                </div>
            </div>
        </div>

    </main>

    <!-- JS LOGIC -->
    <script>
        lucide.createIcons();
        const steps = ["Policy", "Ingest", "Decision", "AI Result", "Evidence", "Action", "Audit"];
        
        // Render Stepper UI
        const stepperContainer = document.getElementById('stepper-container');
        steps.forEach((label, index) => {
            if(index === 3) return; // Skip internal step
            const dot = document.createElement('div');
            dot.className = `flex flex-col items-center gap-1 z-10`;
            dot.innerHTML = `
                <div id="dot-${index}" class="w-3 h-3 rounded-full ${index === 0 ? 'bg-sky-500 ring-4 ring-slate-900' : 'bg-slate-600'} transition-all duration-300"></div>
                <span class="text-[10px] font-bold ${index === 0 ? 'text-white' : 'text-slate-500'} uppercase">${label}</span>
            `;
            stepperContainer.appendChild(dot);
        });

        function nextStep(stepIndex) {
            // Hide all steps
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            
            // Logic for combined steps
            if(stepIndex === 4) {
                 document.getElementById('step-4').classList.add('active');
            } else if(stepIndex === 5) {
                document.getElementById('step-5').classList.add('active');
            } else if(stepIndex === 6) {
                document.getElementById('step-6').classList.add('active');
                renderAuditLog();
            } else {
                // Show requested step
                const target = document.getElementById(`step-${stepIndex}`);
                if(target) target.classList.add('active');
            }

            // Update Stepper Dots
            updateStepper(stepIndex);
            lucide.createIcons();
        }

        function updateStepper(activeIdx) {
            steps.forEach((_, idx) => {
                const dot = document.getElementById(`dot-${idx}`);
                if(!dot) return;
                
                if(idx < activeIdx) {
                    dot.className = "w-3 h-3 rounded-full bg-emerald-500"; // Completed
                } else if (idx === activeIdx) {
                    dot.className = "w-3 h-3 rounded-full bg-sky-500 ring-4 ring-slate-900"; // Active
                } else {
                    dot.className = "w-3 h-3 rounded-full bg-slate-600"; // Inactive
                }
            });
        }

        // Step 2 Logic: Run AI
        function runDecisionEngine() {
            const btn = document.getElementById('btn-run-decision');
            const result = document.getElementById('decision-result');
            
            // Animation
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Analyzing Rules...`;
            
            setTimeout(() => {
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> Analysis Complete`;
                btn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                btn.classList.add('bg-slate-800', 'cursor-default');
                
                // Reveal Result
                result.classList.remove('opacity-50', 'pointer-events-none', 'filter', 'blur-sm');
                lucide.createIcons();
                updateStepper(2);
            }, 1000);
        }

        // Step 4 Logic: Highlight
        function highlightEvidence() {
            const clause = document.getElementById('evidence-clause');
            clause.scrollIntoView({ behavior: 'smooth', block: 'center' });
            clause.classList.add('active-focus');
            setTimeout(() => clause.classList.remove('active-focus'), 2000);
        }

        // Step 5 Logic: Finalize
        let finalDecision = "";
        let finalReason = "";

        function finalizeDecision(decision) {
            const reason = document.getElementById('decision-reason').value;
            if(!reason) {
                alert("Please enter a reason for the audit log.");
                return;
            }
            finalDecision = decision;
            finalReason = reason;
            nextStep(6);
        }

        // Step 6 Logic: Render Audit
        function renderAuditLog() {
            const container = document.getElementById('audit-timeline');
            const now = new Date();
            
            const events = [
                { time: new Date(now - 600000), action: "POLICY_BIND", detail: "Loaded v3.2 (Immutable)", icon: "lock", color: "slate" },
                { time: new Date(now - 500000), action: "INGEST_EVENT", detail: "PR-2024-9981 | Amt: 3.5M", icon: "upload-cloud", color: "blue" },
                { time: new Date(now - 300000), action: "RULE_EXECUTION", detail: "Triggered: HIGH_AMOUNT, SLA_RISK", icon: "zap", color: "amber" },
                { time: new Date(now - 100000), action: "EVIDENCE_VIEW", detail: "User viewed Contract_2024.pdf", icon: "eye", color: "purple" },
                { time: new Date(now), action: finalDecision, detail: `By: Manager | Reason: "${finalReason}"`, icon: finalDecision === 'APPROVED' ? 'check-circle' : 'x-circle', color: finalDecision === 'APPROVED' ? 'emerald' : 'red' }
            ];

            container.innerHTML = events.map(e => `
                <div class="relative mb-6 last:mb-0">
                    <div class="absolute -left-[41px] top-0 w-8 h-8 rounded-full bg-${e.color}-100 border-2 border-${e.color}-500 flex items-center justify-center">
                        <i data-lucide="${e.icon}" class="w-4 h-4 text-${e.color}-600"></i>
                    </div>
                    <div>
                        <span class="text-xs font-mono text-slate-400">${e.time.toLocaleTimeString()}</span>
                        <h4 class="font-bold text-sm text-slate-800">${e.action}</h4>
                        <p class="text-xs text-slate-500 mt-1">${e.detail}</p>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        function resetDemo() {
            location.reload();
        }
    </script>
</body>
</html>